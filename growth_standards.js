// 7岁以下儿童生长标准数据
// 基于《7岁以下儿童生长标准》（代替WS/T 423—2013）

// 身高标准数据 (单位：cm)
// 数据格式：月龄: { P3, P5, P10, P25, P50, P75, P90, P95, P97 }
const heightStandards = {
  male: {
    0: { P3: 48.8, P5: 49.4, P10: 50.2, P25: 51.6, P50: 53.1, P75: 54.6, P90: 56.0, P95: 56.9, P97: 57.5 },
    1: { P3: 52.1, P5: 52.8, P10: 53.7, P25: 55.2, P50: 56.8, P75: 58.4, P90: 59.9, P95: 60.9, P97: 61.5 },
    2: { P3: 55.4, P5: 56.1, P10: 57.1, P25: 58.7, P50: 60.4, P75: 62.1, P90: 63.7, P95: 64.7, P97: 65.4 },
    3: { P3: 57.9, P5: 58.7, P10: 59.7, P25: 61.4, P50: 63.2, P75: 65.0, P90: 66.7, P95: 67.8, P97: 68.5 },
    4: { P3: 59.9, P5: 60.8, P10: 61.9, P25: 63.7, P50: 65.5, P75: 67.4, P90: 69.2, P95: 70.4, P97: 71.1 },
    5: { P3: 61.6, P5: 62.5, P10: 63.7, P25: 65.6, P50: 67.5, P75: 69.5, P90: 71.4, P95: 72.6, P97: 73.4 },
    6: { P3: 63.1, P5: 64.0, P10: 65.2, P25: 67.2, P50: 69.2, P75: 71.2, P90: 73.2, P95: 74.5, P97: 75.3 },
    7: { P3: 64.5, P5: 65.5, P10: 66.7, P25: 68.8, P50: 70.8, P75: 72.9, P90: 75.0, P95: 76.3, P97: 77.2 },
    8: { P3: 65.8, P5: 66.9, P10: 68.1, P25: 70.2, P50: 72.3, P75: 74.5, P90: 76.7, P95: 78.0, P97: 78.9 },
    9: { P3: 67.0, P5: 68.1, P10: 69.4, P25: 71.6, P50: 73.8, P75: 76.0, P90: 78.3, P95: 79.7, P97: 80.6 },
    10: { P3: 68.2, P5: 69.3, P10: 70.6, P25: 72.9, P50: 75.1, P75: 77.4, P90: 79.8, P95: 81.2, P97: 82.1 },
    11: { P3: 69.3, P5: 70.5, P10: 71.8, P25: 74.1, P50: 76.4, P75: 78.8, P90: 81.2, P95: 82.7, P97: 83.6 },
    12: { P3: 70.4, P5: 71.6, P10: 72.9, P25: 75.3, P50: 77.6, P75: 80.1, P90: 82.5, P95: 84.1, P97: 85.0 },
    15: { P3: 73.5, P5: 74.8, P10: 76.2, P25: 78.7, P50: 81.2, P75: 83.8, P90: 86.4, P95: 88.1, P97: 89.1 },
    18: { P3: 76.3, P5: 77.7, P10: 79.2, P25: 81.8, P50: 84.4, P75: 87.1, P90: 89.9, P95: 91.7, P97: 92.7 },
    21: { P3: 78.9, P5: 80.4, P10: 81.9, P25: 84.6, P50: 87.4, P75: 90.1, P90: 93.0, P95: 94.9, P97: 96.0 },
    24: { P3: 81.3, P5: 82.9, P10: 84.5, P25: 87.2, P50: 90.0, P75: 92.9, P90: 95.9, P95: 97.8, P97: 99.0 },
    27: { P3: 83.5, P5: 85.1, P10: 86.8, P25: 89.6, P50: 92.5, P75: 95.5, P90: 98.5, P95: 100.5, P97: 101.8 },
    30: { P3: 85.6, P5: 87.3, P10: 89.0, P25: 91.9, P50: 94.9, P75: 98.0, P90: 101.1, P95: 103.1, P97: 104.4 },
    33: { P3: 87.6, P5: 89.3, P10: 91.1, P25: 94.1, P50: 97.2, P75: 100.4, P90: 103.6, P95: 105.7, P97: 107.0 },
    36: { P3: 89.5, P5: 91.3, P10: 93.1, P25: 96.2, P50: 99.4, P75: 102.7, P90: 106.0, P95: 108.2, P97: 109.5 },
    39: { P3: 91.3, P5: 93.2, P10: 95.0, P25: 98.2, P50: 101.5, P75: 104.9, P90: 108.3, P95: 110.6, P97: 111.9 },
    42: { P3: 93.1, P5: 95.0, P10: 96.9, P25: 100.1, P50: 103.5, P75: 107.0, P90: 110.5, P95: 112.8, P97: 114.2 },
    45: { P3: 94.8, P5: 96.7, P10: 98.7, P25: 102.0, P50: 105.5, P75: 109.0, P90: 112.6, P95: 115.0, P97: 116.4 },
    48: { P3: 96.4, P5: 98.4, P10: 100.4, P25: 103.8, P50: 107.4, P75: 111.0, P90: 114.7, P95: 117.1, P97: 118.6 },
    51: { P3: 98.0, P5: 100.0, P10: 102.1, P25: 105.5, P50: 109.2, P75: 112.9, P90: 116.6, P95: 119.1, P97: 120.6 },
    54: { P3: 99.5, P5: 101.6, P10: 103.7, P25: 107.2, P50: 111.0, P75: 114.8, P90: 118.6, P95: 121.2, P97: 122.7 },
    57: { P3: 101.0, P5: 103.1, P10: 105.3, P25: 108.9, P50: 112.7, P75: 116.6, P90: 120.5, P95: 123.1, P97: 124.7 },
    60: { P3: 102.5, P5: 104.6, P10: 106.8, P25: 110.5, P50: 114.4, P75: 118.4, P90: 122.3, P95: 125.0, P97: 126.6 },
    63: { P3: 103.9, P5: 106.1, P10: 108.3, P25: 112.1, P50: 116.1, P75: 120.1, P90: 124.1, P95: 126.9, P97: 128.5 },
    66: { P3: 105.3, P5: 107.5, P10: 109.8, P25: 113.6, P50: 117.7, P75: 121.8, P90: 125.9, P95: 128.7, P97: 130.4 }
  },
  female: {
    0: { P3: 48.5, P5: 49.1, P10: 50.0, P25: 51.4, P50: 52.9, P75: 54.4, P90: 55.9, P95: 56.8, P97: 57.4 },
    1: { P3: 51.8, P5: 52.5, P10: 53.4, P25: 54.9, P50: 56.5, P75: 58.1, P90: 59.6, P95: 60.6, P97: 61.2 },
    2: { P3: 55.0, P5: 55.8, P10: 56.8, P25: 58.4, P50: 60.1, P75: 61.8, P90: 63.4, P95: 64.4, P97: 65.1 },
    3: { P3: 57.6, P5: 58.4, P10: 59.4, P25: 61.1, P50: 62.9, P75: 64.7, P90: 66.4, P95: 67.5, P97: 68.2 },
    4: { P3: 59.7, P5: 60.5, P10: 61.6, P25: 63.4, P50: 65.2, P75: 67.1, P90: 68.9, P95: 70.1, P97: 70.8 },
    5: { P3: 61.4, P5: 62.3, P10: 63.5, P25: 65.4, P50: 67.3, P75: 69.3, P90: 71.2, P95: 72.4, P97: 73.2 },
    6: { P3: 63.0, P5: 63.9, P10: 65.1, P25: 67.1, P50: 69.1, P75: 71.1, P90: 73.1, P95: 74.4, P97: 75.2 },
    7: { P3: 64.5, P5: 65.4, P10: 66.7, P25: 68.7, P50: 70.8, P75: 72.9, P90: 75.0, P95: 76.3, P97: 77.2 },
    8: { P3: 65.9, P5: 66.8, P10: 68.2, P25: 70.3, P50: 72.4, P75: 74.6, P90: 76.8, P95: 78.2, P97: 79.1 },
    9: { P3: 67.2, P5: 68.2, P10: 69.6, P25: 71.8, P50: 74.0, P75: 76.3, P90: 78.6, P95: 80.0, P97: 80.9 },
    10: { P3: 68.5, P5: 69.5, P10: 70.9, P25: 73.2, P50: 75.5, P75: 77.8, P90: 80.2, P95: 81.7, P97: 82.6 },
    11: { P3: 69.7, P5: 70.8, P10: 72.2, P25: 74.6, P50: 76.9, P75: 79.3, P90: 81.8, P95: 83.3, P97: 84.3 },
    12: { P3: 70.9, P5: 72.0, P10: 73.5, P25: 75.9, P50: 78.3, P75: 80.8, P90: 83.3, P95: 84.9, P97: 85.9 },
    15: { P3: 74.0, P5: 75.3, P10: 76.8, P25: 79.4, P50: 81.9, P75: 84.6, P90: 87.2, P95: 88.9, P97: 89.9 },
    18: { P3: 76.8, P5: 78.2, P10: 79.8, P25: 82.5, P50: 85.1, P75: 87.9, P90: 90.6, P95: 92.4, P97: 93.5 },
    21: { P3: 79.4, P5: 80.9, P10: 82.5, P25: 85.3, P50: 88.0, P75: 90.8, P90: 93.6, P95: 95.5, P97: 96.6 },
    24: { P3: 81.8, P5: 83.4, P10: 85.1, P25: 87.9, P50: 90.7, P75: 93.6, P90: 96.5, P95: 98.4, P97: 99.6 },
    27: { P3: 84.0, P5: 85.7, P10: 87.4, P25: 90.3, P50: 93.2, P75: 96.2, P90: 99.1, P95: 101.1, P97: 102.4 },
    30: { P3: 86.1, P5: 87.9, P10: 89.6, P25: 92.6, P50: 95.6, P75: 98.6, P90: 101.6, P95: 103.7, P97: 105.0 },
    33: { P3: 88.1, P5: 89.9, P10: 91.7, P25: 94.8, P50: 97.9, P75: 101.0, P90: 104.1, P95: 106.3, P97: 107.6 },
    36: { P3: 90.0, P5: 91.9, P10: 93.7, P25: 96.9, P50: 100.1, P75: 103.3, P90: 106.5, P95: 108.7, P97: 110.1 },
    39: { P3: 91.8, P5: 93.8, P10: 95.6, P25: 98.9, P50: 102.2, P75: 105.5, P90: 108.8, P95: 111.1, P97: 112.5 },
    42: { P3: 93.6, P5: 95.6, P10: 97.5, P25: 100.8, P50: 104.2, P75: 107.6, P90: 111.0, P95: 113.4, P97: 114.8 },
    45: { P3: 95.3, P5: 97.4, P10: 99.3, P25: 102.7, P50: 106.2, P75: 109.7, P90: 113.2, P95: 115.6, P97: 117.1 },
    48: { P3: 97.0, P5: 99.1, P10: 101.1, P25: 104.6, P50: 108.1, P75: 111.7, P90: 115.3, P95: 117.8, P97: 119.3 },
    51: { P3: 98.6, P5: 100.8, P10: 102.8, P25: 106.4, P50: 110.0, P75: 113.7, P90: 117.4, P95: 119.9, P97: 121.5 },
    54: { P3: 100.2, P5: 102.4, P10: 104.5, P25: 108.1, P50: 111.8, P75: 115.6, P90: 119.4, P95: 122.0, P97: 123.6 },
    57: { P3: 101.7, P5: 104.0, P10: 106.1, P25: 109.8, P50: 113.6, P75: 117.4, P90: 121.3, P95: 123.9, P97: 125.6 },
    60: { P3: 103.2, P5: 105.5, P10: 107.7, P25: 111.5, P50: 115.3, P75: 119.2, P90: 123.2, P95: 125.9, P97: 127.6 },
    63: { P3: 104.7, P5: 107.0, P10: 109.3, P25: 113.1, P50: 117.0, P75: 121.0, P90: 125.0, P95: 127.8, P97: 129.5 },
    66: { P3: 106.1, P5: 108.5, P10: 110.8, P25: 114.7, P50: 118.7, P75: 122.7, P90: 126.8, P95: 129.6, P97: 131.4 }
  }
};

// 体重标准数据 (单位：kg)
const weightStandards = {
  male: {
    0: { P3: 2.6, P5: 2.8, P10: 3.0, P25: 3.4, P50: 3.8, P75: 4.2, P90: 4.6, P95: 4.9, P97: 5.1 },
    1: { P3: 4.3, P5: 4.6, P10: 4.9, P25: 5.4, P50: 5.9, P75: 6.5, P90: 7.1, P95: 7.5, P97: 7.8 },
    2: { P3: 5.3, P5: 5.6, P10: 6.0, P25: 6.6, P50: 7.2, P75: 7.9, P90: 8.6, P95: 9.1, P97: 9.5 },
    3: { P3: 5.9, P5: 6.3, P10: 6.7, P25: 7.4, P50: 8.1, P75: 8.9, P90: 9.7, P95: 10.3, P97: 10.7 },
    4: { P3: 6.4, P5: 6.8, P10: 7.3, P25: 8.0, P50: 8.8, P75: 9.7, P90: 10.6, P95: 11.2, P97: 11.7 },
    5: { P3: 6.8, P5: 7.2, P10: 7.8, P25: 8.6, P50: 9.4, P75: 10.4, P90: 11.4, P95: 12.1, P97: 12.6 },
    6: { P3: 7.1, P5: 7.6, P10: 8.2, P25: 9.0, P50: 9.9, P75: 10.9, P90: 12.0, P95: 12.8, P97: 13.3 },
    7: { P3: 7.4, P5: 7.9, P10: 8.5, P25: 9.4, P50: 10.3, P75: 11.4, P90: 12.5, P95: 13.4, P97: 13.9 },
    8: { P3: 7.7, P5: 8.2, P10: 8.8, P25: 9.8, P50: 10.8, P75: 11.9, P90: 13.1, P95: 14.0, P97: 14.6 },
    9: { P3: 7.9, P5: 8.5, P10: 9.1, P25: 10.1, P50: 11.2, P75: 12.3, P90: 13.6, P95: 14.5, P97: 15.1 },
    10: { P3: 8.1, P5: 8.7, P10: 9.4, P25: 10.4, P50: 11.5, P75: 12.7, P90: 14.0, P95: 15.0, P97: 15.6 },
    11: { P3: 8.3, P5: 8.9, P10: 9.6, P25: 10.7, P50: 11.8, P75: 13.1, P90: 14.4, P95: 15.4, P97: 16.1 },
    12: { P3: 8.5, P5: 9.1, P10: 9.8, P25: 10.9, P50: 12.1, P75: 13.4, P90: 14.8, P95: 15.8, P97: 16.5 },
    15: { P3: 9.2, P5: 9.9, P10: 10.6, P25: 11.8, P50: 13.0, P75: 14.4, P90: 15.9, P95: 17.0, P97: 17.7 },
    18: { P3: 9.8, P5: 10.5, P10: 11.3, P25: 12.6, P50: 13.9, P75: 15.4, P90: 17.0, P95: 18.2, P97: 19.0 },
    21: { P3: 10.3, P5: 11.1, P10: 11.9, P25: 13.3, P50: 14.7, P75: 16.3, P90: 18.0, P95: 19.3, P97: 20.1 },
    24: { P3: 10.8, P5: 11.6, P10: 12.5, P25: 13.9, P50: 15.4, P75: 17.1, P90: 18.9, P95: 20.3, P97: 21.2 },
    27: { P3: 11.3, P5: 12.1, P10: 13.0, P25: 14.5, P50: 16.1, P75: 17.9, P90: 19.8, P95: 21.3, P97: 22.2 },
    30: { P3: 11.7, P5: 12.6, P10: 13.5, P25: 15.1, P50: 16.8, P75: 18.6, P90: 20.6, P95: 22.2, P97: 23.1 },
    33: { P3: 12.1, P5: 13.0, P10: 13.9, P25: 15.6, P50: 17.3, P75: 19.2, P90: 21.3, P95: 22.9, P97: 23.9 },
    36: { P3: 12.5, P5: 13.4, P10: 14.4, P25: 16.1, P50: 17.9, P75: 19.9, P90: 22.0, P95: 23.7, P97: 24.7 },
    39: { P3: 12.8, P5: 13.8, P10: 14.8, P25: 16.6, P50: 18.4, P75: 20.5, P90: 22.7, P95: 24.4, P97: 25.4 },
    42: { P3: 13.2, P5: 14.2, P10: 15.2, P25: 17.0, P50: 18.9, P75: 21.0, P90: 23.3, P95: 25.0, P97: 26.1 },
    45: { P3: 13.5, P5: 14.5, P10: 15.6, P25: 17.5, P50: 19.4, P75: 21.6, P90: 24.0, P95: 25.8, P97: 26.9 },
    48: { P3: 13.8, P5: 14.9, P10: 16.0, P25: 17.9, P50: 19.9, P75: 22.1, P90: 24.6, P95: 26.4, P97: 27.6 },
    51: { P3: 14.1, P5: 15.2, P10: 16.4, P25: 18.4, P50: 20.4, P75: 22.7, P90: 25.3, P95: 27.1, P97: 28.3 },
    54: { P3: 14.4, P5: 15.6, P10: 16.8, P25: 18.8, P50: 20.9, P75: 23.3, P90: 25.9, P95: 27.8, P97: 29.0 },
    57: { P3: 14.7, P5: 15.9, P10: 17.2, P25: 19.3, P50: 21.4, P75: 23.9, P90: 26.5, P95: 28.5, P97: 29.7 },
    60: { P3: 15.0, P5: 16.2, P10: 17.5, P25: 19.7, P50: 21.9, P75: 24.4, P90: 27.1, P95: 29.1, P97: 30.4 },
    63: { P3: 15.3, P5: 16.5, P10: 17.9, P25: 20.1, P50: 22.3, P75: 24.9, P90: 27.6, P95: 29.7, P97: 31.0 },
    66: { P3: 15.6, P5: 16.8, P10: 18.2, P25: 20.5, P50: 22.8, P75: 25.4, P90: 28.2, P95: 30.3, P97: 31.6 }
  },
  female: {
    0: { P3: 2.5, P5: 2.7, P10: 2.9, P25: 3.3, P50: 3.7, P75: 4.1, P90: 4.5, P95: 4.8, P97: 5.0 },
    1: { P3: 4.1, P5: 4.4, P10: 4.7, P25: 5.2, P50: 5.7, P75: 6.3, P90: 6.9, P95: 7.3, P97: 7.6 },
    2: { P3: 5.0, P5: 5.3, P10: 5.7, P25: 6.3, P50: 6.9, P75: 7.6, P90: 8.3, P95: 8.8, P97: 9.2 },
    3: { P3: 5.5, P5: 5.9, P10: 6.3, P25: 7.0, P50: 7.7, P75: 8.5, P90: 9.2, P95: 9.8, P97: 10.2 },
    4: { P3: 5.9, P5: 6.4, P10: 6.8, P25: 7.6, P50: 8.4, P75: 9.2, P90: 10.1, P95: 10.7, P97: 11.1 },
    5: { P3: 6.3, P5: 6.7, P10: 7.2, P25: 8.0, P50: 8.9, P75: 9.8, P90: 10.7, P95: 11.4, P97: 11.8 },
    6: { P3: 6.6, P5: 7.0, P10: 7.6, P25: 8.4, P50: 9.3, P75: 10.3, P90: 11.3, P95: 12.0, P97: 12.5 },
    7: { P3: 6.8, P5: 7.3, P10: 7.9, P25: 8.8, P50: 9.7, P75: 10.8, P90: 11.8, P95: 12.6, P97: 13.1 },
    8: { P3: 7.1, P5: 7.6, P10: 8.2, P25: 9.1, P50: 10.1, P75: 11.2, P90: 12.3, P95: 13.1, P97: 13.7 },
    9: { P3: 7.3, P5: 7.8, P10: 8.5, P25: 9.4, P50: 10.5, P75: 11.6, P90: 12.7, P95: 13.6, P97: 14.2 },
    10: { P3: 7.5, P5: 8.0, P10: 8.7, P25: 9.7, P50: 10.8, P75: 11.9, P90: 13.1, P95: 14.0, P97: 14.6 },
    11: { P3: 7.7, P5: 8.2, P10: 8.9, P25: 9.9, P50: 11.1, P75: 12.3, P90: 13.5, P95: 14.4, P97: 15.1 },
    12: { P3: 7.8, P5: 8.4, P10: 9.1, P25: 10.2, P50: 11.4, P75: 12.6, P90: 13.8, P95: 14.8, P97: 15.5 },
    15: { P3: 8.5, P5: 9.1, P10: 9.9, P25: 11.0, P50: 12.3, P75: 13.6, P90: 15.0, P95: 16.0, P97: 16.7 },
    18: { P3: 9.1, P5: 9.7, P10: 10.5, P25: 11.7, P50: 13.1, P75: 14.5, P90: 16.0, P95: 17.1, P97: 17.9 },
    21: { P3: 9.6, P5: 10.3, P10: 11.1, P25: 12.4, P50: 13.8, P75: 15.3, P90: 16.9, P95: 18.1, P97: 18.9 },
    24: { P3: 10.1, P5: 10.8, P10: 11.6, P25: 13.0, P50: 14.5, P75: 16.1, P90: 17.8, P95: 19.1, P97: 20.0 },
    27: { P3: 10.5, P5: 11.3, P10: 12.1, P25: 13.6, P50: 15.1, P75: 16.8, P90: 18.6, P95: 20.0, P97: 20.9 },
    30: { P3: 10.9, P5: 11.7, P10: 12.6, P25: 14.1, P50: 15.7, P75: 17.5, P90: 19.4, P95: 20.9, P97: 21.8 },
    33: { P3: 11.3, P5: 12.1, P10: 13.0, P25: 14.6, P50: 16.3, P75: 18.1, P90: 20.1, P95: 21.6, P97: 22.6 },
    36: { P3: 11.6, P5: 12.5, P10: 13.4, P25: 15.1, P50: 16.8, P75: 18.7, P90: 20.8, P95: 22.4, P97: 23.4 },
    39: { P3: 11.9, P5: 12.8, P10: 13.8, P25: 15.5, P50: 17.3, P75: 19.3, P90: 21.4, P95: 23.1, P97: 24.1 },
    42: { P3: 12.2, P5: 13.2, P10: 14.2, P25: 15.9, P50: 17.8, P75: 19.8, P90: 22.0, P95: 23.7, P97: 24.8 },
    45: { P3: 12.5, P5: 13.5, P10: 14.6, P25: 16.4, P50: 18.3, P75: 20.4, P90: 22.7, P95: 24.4, P97: 25.6 },
    48: { P3: 12.8, P5: 13.8, P10: 15.0, P25: 16.8, P50: 18.8, P75: 21.0, P90: 23.3, P95: 25.1, P97: 26.3 },
    51: { P3: 13.1, P5: 14.1, P10: 15.3, P25: 17.2, P50: 19.3, P75: 21.5, P90: 23.9, P95: 25.7, P97: 27.0 },
    54: { P3: 13.4, P5: 14.4, P10: 15.7, P25: 17.6, P50: 19.7, P75: 22.0, P90: 24.5, P95: 26.4, P97: 27.7 },
    57: { P3: 13.6, P5: 14.7, P10: 16.0, P25: 18.0, P50: 20.2, P75: 22.5, P90: 25.1, P95: 27.0, P97: 28.4 },
    60: { P3: 13.9, P5: 15.0, P10: 16.3, P25: 18.4, P50: 20.6, P75: 23.0, P90: 25.6, P95: 27.6, P97: 29.0 },
    63: { P3: 14.2, P5: 15.3, P10: 16.6, P25: 18.7, P50: 21.0, P75: 23.5, P90: 26.1, P95: 28.2, P97: 29.6 },
    66: { P3: 14.4, P5: 15.6, P10: 16.9, P25: 19.1, P50: 21.4, P75: 23.9, P90: 26.6, P95: 28.7, P97: 30.2 }
  }
};

// 获取指定月龄和性别的身高百分位数值
function getHeightPercentile(gender, ageInMonths, actualHeight) {
  const standards = heightStandards[gender];
  if (!standards) return null;
  
  // 找到最接近的月龄标准
  let closestAge = Object.keys(standards).reduce((prev, curr) => 
    Math.abs(curr - ageInMonths) < Math.abs(prev - ageInMonths) ? curr : prev
  );
  
  const standard = standards[closestAge];
  if (!standard) return null;
  
  // 确定实际身高落在哪个百分位区间
  const percentiles = ['P3', 'P5', 'P10', 'P25', 'P50', 'P75', 'P90', 'P95', 'P97'];
  for (let i = 0; i < percentiles.length - 1; i++) {
    if (actualHeight >= standard[percentiles[i]] && actualHeight <= standard[percentiles[i + 1]]) {
      return {
        lower: percentiles[i],
        upper: percentiles[i + 1],
        lowerValue: standard[percentiles[i]],
        upperValue: standard[percentiles[i + 1]]
      };
    }
  }
  
  // 如果低于最小值或高于最大值
  if (actualHeight < standard.P3) {
    return { below: 'P3', value: standard.P3 };
  } else if (actualHeight > standard.P97) {
    return { above: 'P97', value: standard.P97 };
  }
  
  return null;
}

// 获取指定月龄和性别的体重百分位数值
function getWeightPercentile(gender, ageInMonths, actualWeight) {
  const standards = weightStandards[gender];
  if (!standards) return null;
  
  // 找到最接近的月龄标准
  let closestAge = Object.keys(standards).reduce((prev, curr) => 
    Math.abs(curr - ageInMonths) < Math.abs(prev - ageInMonths) ? curr : prev
  );
  
  const standard = standards[closestAge];
  if (!standard) return null;
  
  // 确定实际体重落在哪个百分位区间
  const percentiles = ['P3', 'P5', 'P10', 'P25', 'P50', 'P75', 'P90', 'P95', 'P97'];
  for (let i = 0; i < percentiles.length - 1; i++) {
    if (actualWeight >= standard[percentiles[i]] && actualWeight <= standard[percentiles[i + 1]]) {
      return {
        lower: percentiles[i],
        upper: percentiles[i + 1],
        lowerValue: standard[percentiles[i]],
        upperValue: standard[percentiles[i + 1]]
      };
    }
  }
  
  // 如果低于最小值或高于最大值
  if (actualWeight < standard.P3) {
    return { below: 'P3', value: standard.P3 };
  } else if (actualWeight > standard.P97) {
    return { above: 'P97', value: standard.P97 };
  }
  
  return null;
}

// 将生长标准数据集成到主应用中
function integrateGrowthStandards() {
  // 扩展GrowthTracker类以包含标准对比功能
  if (typeof GrowthTracker !== 'undefined') {
    // 保存原始方法
    const originalRenderRecordsTable = GrowthTracker.prototype.renderRecordsTable;
    
    // 扩展记录表格渲染方法以包含标准对比
    GrowthTracker.prototype.renderRecordsTable = function() {
      // 调用原始方法
      originalRenderRecordsTable.call(this);
      
      // 添加标准对比信息到表格中
      const tbody = document.getElementById('recordsTableBody');
      const rows = tbody.querySelectorAll('tr');
      
      rows.forEach((row, index) => {
        const record = this.records.find(r => {
          // 找到对应记录
          return r.id === parseInt(row.querySelector('.delete-btn').onclick.toString().match(/deleteRecord\((\d+)\)/)[1]);
        });
        
        if (record) {
          // 获取身高和体重的百分位
          const heightPercentile = getHeightPercentile(record.childGender, record.ageInMonths, record.height);
          const weightPercentile = getWeightPercentile(record.childGender, record.ageInMonths, record.weight);
          
          // 在表格中添加百分位信息
          const heightCell = row.cells[2];
          const weightCell = row.cells[3];
          
          // 添加标准对比信息的提示
          if (heightPercentile) {
            let percentileText = '';
            if (heightPercentile.lower) {
              percentileText = ` (${heightPercentile.lower}-${heightPercentile.upper})`;
            } else if (heightPercentile.below) {
              percentileText = ` (<${heightPercentile.below})`;
            } else if (heightPercentile.above) {
              percentileText = ` (>${heightPercentile.above})`;
            }
            heightCell.title = `身高百分位: ${percentileText}`;
          }
          
          if (weightPercentile) {
            let percentileText = '';
            if (weightPercentile.lower) {
              percentileText = ` (${weightPercentile.lower}-${weightPercentile.upper})`;
            } else if (weightPercentile.below) {
              percentileText = ` (<${weightPercentile.below})`;
            } else if (weightPercentile.above) {
              percentileText = ` (>${weightPercentile.above})`;
            }
            weightCell.title = `体重百分位: ${percentileText}`;
          }
        }
      });
    };
  }
}

// 初始化标准数据集成
document.addEventListener('DOMContentLoaded', integrateGrowthStandards);